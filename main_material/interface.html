<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Compass - AI-Powered Resume Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1rem;
            opacity: 0.7;
            font-style: italic;
        }

        .upload-area {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 2rem;
            text-align: center;
            border: 3px dashed #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(255,255,255,1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: #4CAF50;
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            color: #666;
            margin-bottom: 2rem;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .progress-section {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: none;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        /* New Profile Review Section */
        .profile-review-section {
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .review-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .review-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .review-header p {
            color: #666;
            font-size: 1rem;
        }

        .profile-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .skills-input-container {
            position: relative;
        }

        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
            min-height: 40px;
            padding: 0.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }

        .skill-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 16px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .skill-remove {
            cursor: pointer;
            font-weight: bold;
            color: #666;
        }

        .skill-remove:hover {
            color: #f44336;
        }

        .multi-select-container {
            position: relative;
        }

        .multi-select-input {
            cursor: pointer;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .multi-select-option {
            padding: 0.8rem;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .multi-select-option:hover {
            background: #f5f5f5;
        }

        .multi-select-option.selected {
            background: #e8f5e8;
            color: #2e7d32;
            font-weight: 600;
        }

        .generate-analysis-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            min-width: 250px;
        }

        .generate-analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .profile-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .profile-item {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid rgba(255,255,255,0.3);
        }

        .profile-item strong {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .profile-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .market-score {
            text-align: center;
            margin-bottom: 3rem;
        }

        .score-display {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 3rem;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .score-description {
            color: #666;
            font-size: 1rem;
        }

        .analysis-sections {
            display: grid;
            gap: 2rem;
        }

        .analysis-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            flex: 1;
        }

        .section-score {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
        }

        .section-content {
            line-height: 1.6;
            color: #555;
        }

        .subsection {
            margin-bottom: 1.5rem;
        }

        .subsection-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .error-message, .success-message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .section-1 { border-left-color: #4CAF50; }
        .section-2 { border-left-color: #2196F3; }
        .section-3 { border-left-color: #FF9800; }
        .section-4 { border-left-color: #9C27B0; }
        .section-5 { border-left-color: #F44336; }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .upload-area {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Career Determination</h1>
            <p>AI-Powered Resume Analysis with Content-Based Job Recommendations</p>
            <p class="subtitle">Powered by Llama 3.3 70B Courtesy of CrewAI & Python - Intelligent Profile Extraction & Market Analysis</p>
        </div>

        <!-- Step 1: Upload Area -->
        <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
            <div class="upload-icon">📄</div>
            <div class="upload-text">Upload Your Resume PDF</div>
            <div class="upload-subtext">AI will automatically extract your profile and recommend optimal career paths</div>
            <button class="upload-btn">Choose PDF File</button>
            <input type="file" id="file-input" class="file-input" accept=".pdf" />
        </div>

        <!-- Step 2: Progress Section -->
        <div class="progress-section" id="progress-section">
            <div class="progress-text" id="progress-text">Initializing AI analysis...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Step 3: Profile Review Section (NEW) -->
        <div class="profile-review-section" id="profile-review-section">
            <div class="review-header">
                <h2>Review & Customize Your Profile</h2>
                <p>AI has extracted your profile information. Please review and modify as needed before generating your detailed analysis.</p>
            </div>

            <form class="profile-form" id="profile-form">
                <div class="form-group">
                    <label class="form-label">Experience Level</label>
                    <select class="form-select" id="experience-level">
                        <option value="entry">Entry Level (0-2 years)</option>
                        <option value="mid">Mid Level (3-7 years)</option>
                        <option value="senior">Senior Level (8-15 years)</option>
                        <option value="executive">Executive Level (15+ years)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Current Location</label>
                    <input type="text" class="form-input" id="current-location" placeholder="e.g., San Francisco, CA">
                </div>

                <div class="profile-review-section" id="profile-review-section">
                <form class="profile-form" id="profile-form">
                    <div class="form-group">
                        <label class="form-label">Target Job Categories</label>
                        <div class="multi-select-container">
                            <input type="text" class="form-input multi-select-input" id="job-categories-input" placeholder="Select job categories..." readonly onclick="toggleDropdown('job-categories')">
                            <div class="multi-select-dropdown" id="job-categories-dropdown">
                                <div class="multi-select-option" data-value="Accountant">Accountant</div>
                                <div class="multi-select-option" data-value="Advocate">Advocate (Legal/Policy)</div>
                                <div class="multi-select-option" data-value="Agriculture">Agriculture</div>
                                <div class="multi-select-option" data-value="Apparel">Apparel</div>
                                <div class="multi-select-option" data-value="Arts">Arts & Culture</div>
                                <div class="multi-select-option" data-value="Automobile">Automobile</div>
                                <div class="multi-select-option" data-value="Aviation">Aviation</div>
                                <div class="multi-select-option" data-value="Banking">Banking</div>
                                <div class="multi-select-option" data-value="BOP">Business Operations (BOP)</div>
                                <div class="multi-select-option" data-value="Business-Development">Business Development</div>
                                <div class="multi-select-option" data-value="Chef">Chef / Culinary</div>
                                <div class="multi-select-option" data-value="Construction">Construction</div>
                                <div class="multi-select-option" data-value="Designer">Designer</div>
                                <div class="multi-select-option" data-value="Digital Media">Digital Media</div>
                                <div class="multi-select-option" data-value="Engineering">Engineering</div>
                                <div class="multi-select-option" data-value="Finance">Finance</div>
                                <div class="multi-select-option" data-value="Fitness">Fitness</div>
                                <div class="multi-select-option" data-value="Healthcare">Healthcare</div>
                                <div class="multi-select-option" data-value="HR">Human Resources (HR)</div>
                                <div class="multi-select-option" data-value="IT">Information Technology (IT)</div>
                                <div class="multi-select-option" data-value="PR">Public Relations (PR)</div>
                                <div class="multi-select-option" data-value="Sales">Sales</div>
                                <div class="multi-select-option" data-value="Teacher">Teacher / Education</div>
                            </div>
                        </div>
                    </div>
                    
                    </form>
                </div>

                <div class="form-group">
                    <label class="form-label">Recommended Roles</label>
                    <textarea class="form-textarea" id="target-roles" placeholder="e.g., Full Stack Developer, Software Engineer, Technical Lead"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Key Skills</label>
                    <div class="skills-input-container">
                        <input type="text" class="form-input" id="skills-input" placeholder="Type a skill and press Enter">
                        <div class="skills-tags" id="skills-tags"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Work Style Preference</label>
                    <select class="form-select" id="work-style">
                        <option value="Remote">Remote</option>
                        <option value="Hybrid">Hybrid</option>
                        <option value="On-site">On-site</option>
                        <option value="Flexible">Flexible</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Estimated Salary Range</label>
                    <input type="text" class="form-input" id="salary-range" placeholder="e.g., $80,000-$120,000">
                </div>

                <div class="form-group">
                    <label class="form-label">Education Level</label>
                    <select class="form-select" id="education-level">
                        <option value="High School">High School</option>
                        <option value="Associate's">Associate's Degree</option>
                        <option value="Bachelor's">Bachelor's Degree</option>
                        <option value="Master's">Master's Degree</option>
                        <option value="PhD">PhD</option>
                        <option value="Professional">Professional Certification</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Target Industries</label>
                    <div class="multi-select-container">
                        <input type="text" class="form-input multi-select-input" id="industries-input" placeholder="Select industries..." readonly onclick="toggleDropdown('industries')">
                        <div class="multi-select-dropdown" id="industries-dropdown">
                            <div class="multi-select-option" data-value="Technology">Technology</div>
                            <div class="multi-select-option" data-value="Finance">Finance</div>
                            <div class="multi-select-option" data-value="Healthcare">Healthcare</div>
                            <div class="multi-select-option" data-value="Education">Education</div>
                            <div class="multi-select-option" data-value="Retail">Retail</div>
                            <div class="multi-select-option" data-value="Manufacturing">Manufacturing</div>
                            <div class="multi-select-option" data-value="Media & Entertainment">Media & Entertainment</div>
                            <div class="multi-select-option" data-value="Government">Government</div>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="grid-column: 1 / -1;">
                    <label class="form-label">Career Focus</label>
                    <textarea class="form-textarea" id="career-focus" placeholder="Describe your career goals and focus areas"></textarea>
                </div>
            </form>

            <button class="generate-analysis-btn" onclick="generateDetailedAnalysis()">
                Generate Detailed Analysis
            </button>
        </div>

        <!-- Step 4: Results Section -->
        <div class="results-section" id="results-section">
            <!-- Final Profile Summary -->
            <div class="profile-summary" id="profile-summary">
                <h2>Your Professional Profile</h2>
                <div class="profile-grid" id="profile-grid">
                    <!-- Profile items will be inserted here -->
                </div>
            </div>

            <!-- Market Competitiveness Score -->
            <div class="market-score">
                <div class="score-display" id="market-score">Market Readiness: --/10</div>
                <div class="score-description" id="score-description">Overall competitiveness for target roles in current market</div>
            </div>

            <!-- Analysis Sections -->
            <div class="analysis-sections" id="analysis-sections">
                <!-- Analysis sections will be dynamically generated -->
            </div>
        </div>

        <div id="error-message" class="error-message"></div>
        <div id="success-message" class="success-message"></div>
    </div>

    <script>
        let analysisInProgress = false;
        let extractedProfile = {};
        let selectedJobCategories = [];
        let selectedIndustries = [];
        let skillsList = [];

        // File upload handling
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');

        fileInput.addEventListener('change', handleFileUpload);

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                handleFileUpload({ target: { files: files } });
            } else {
                showMessage('Please upload a PDF file only', 'error');
            }
        });

        function handleFileUpload(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                showMessage('Please upload a PDF file only', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) { // 10MB limit
                showMessage('File size must be less than 10MB', 'error');
                return;
            }
            
            showMessage(`${file.name} uploaded successfully! AI profile extraction starting...`, 'success');
            startProfileExtraction(file);
        }

        async function startProfileExtraction(file) {
            if (analysisInProgress) return;
            
            analysisInProgress = true;
            showProgress();
            
            try {
                await simulateProfileExtraction(file);
                const profile = await extractProfileFromFile(file);
                showProfileReviewSection(profile);
            } catch (error) {
                showMessage('Profile extraction failed. Please try again.', 'error');
            } finally {
                analysisInProgress = false;
                hideProgress();
            }
        }

        async function simulateProfileExtraction(file) {
            const steps = [
                'Processing PDF document...',
                'Extracting text content with OCR...',
                'Analyzing candidate background...',
                'Identifying skills and experience...',
                'Determining job categories...',
                'Estimating experience level...',
                'Extracting education and location...',
                'Preparing profile for review...'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                updateProgress((i + 1) / steps.length * 100, steps[i]);
                await new Promise(resolve => setTimeout(resolve, 800));
            }
        }

        async function extractProfileFromFile(file) {
            // Simulate AI profile extraction
            const experienceLevels = ['entry', 'mid', 'senior'];
            const locations = ['San Francisco, CA', 'New York, NY', 'Austin, TX', 'Seattle, WA', 'Remote'];
            const categories = [
                ['Software Development', 'Data & Analytics'],
                ['Product & Design', 'Management & Leadership'],
                ['Cloud & Infrastructure', 'Cybersecurity']
            ];
            const skills = [
                ['Python', 'JavaScript', 'React', 'AWS', 'Docker'],
                ['Project Management', 'Data Analysis', 'SQL', 'Agile', 'Leadership'],
                ['Machine Learning', 'Node.js', 'Kubernetes', 'Git', 'API Design']
            ];

            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const randomSkills = skills[Math.floor(Math.random() * skills.length)];
            const expLevel = experienceLevels[Math.floor(Math.random() * experienceLevels.length)];

            return {
                experience_level: expLevel,
                current_location: locations[Math.floor(Math.random() * locations.length)],
                job_categories: randomCategory,
                target_roles: generateTargetRoles(randomCategory),
                key_skills: randomSkills,
                industries: ['Technology', 'Finance'][Math.floor(Math.random() * 2)],
                work_arrangement_preference: ['Remote', 'Hybrid', 'Flexible'][Math.floor(Math.random() * 3)],
                estimated_salary_range: generateSalaryRange(expLevel),
                education_level: ['Bachelor\'s', 'Master\'s', 'PhD'][Math.floor(Math.random() * 3)],
                career_focus: 'Professional growth and development in target industry'
            };
        }

        function generateTargetRoles(categories) {
            const roleMap = {
                'Software Development': ['Full Stack Developer', 'Senior Software Engineer', 'Frontend Developer'],
                'Data & Analytics': ['Data Scientist', 'ML Engineer', 'Analytics Manager'],
                'Product & Design': ['Product Manager', 'UX Designer', 'Product Owner'],
                'Management & Leadership': ['Engineering Manager', 'Team Lead', 'Technical Director'],
                'Cloud & Infrastructure': ['Cloud Engineer', 'DevOps Engineer', 'Site Reliability Engineer'],
                'Cybersecurity': ['Security Analyst', 'Penetration Tester', 'Security Engineer']
            };
            
            return categories.flatMap(cat => roleMap[cat] || ['Specialist', 'Analyst']);
        }

        function generateSalaryRange(level) {
            const ranges = {
                'entry': '$60,000-$85,000',
                'mid': '$85,000-$125,000',
                'senior': '$125,000-$180,000'
            };
            return ranges[level] || '$70,000-$100,000';
        }

        function showProfileReviewSection(profile) {
            extractedProfile = profile;
            
            // Populate form fields with extracted data
            document.getElementById('experience-level').value = profile.experience_level;
            document.getElementById('current-location').value = profile.current_location;
            document.getElementById('target-roles').value = profile.target_roles.join(', ');
            document.getElementById('work-style').value = profile.work_arrangement_preference;
            document.getElementById('salary-range').value = profile.estimated_salary_range;
            document.getElementById('education-level').value = profile.education_level;
            document.getElementById('career-focus').value = profile.career_focus;
            
            // Set job categories and industries
            selectedJobCategories = [...profile.job_categories];
            selectedIndustries = Array.isArray(profile.industries) ? profile.industries : [profile.industries];
            updateMultiSelectDisplay('job-categories', selectedJobCategories);
            updateMultiSelectDisplay('industries', selectedIndustries);
            
            // Set skills
            skillsList = [...profile.key_skills];
            updateSkillsDisplay();
            
            // Show the review section
            document.getElementById('profile-review-section').style.display = 'block';
            document.getElementById('profile-review-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Multi-select dropdown functionality
        function toggleDropdown(type) {
            const dropdown = document.getElementById(type + '-dropdown');
            const isVisible = dropdown.style.display === 'block';
            
            // Close all dropdowns
            document.querySelectorAll('.multi-select-dropdown').forEach(dd => dd.style.display = 'none');
            
            if (!isVisible) {
                dropdown.style.display = 'block';
                updateDropdownSelection(type);
            }
        }

        function updateDropdownSelection(type) {
            const dropdown = document.getElementById(type + '-dropdown');
            const selected = type === 'job-categories' ? selectedJobCategories : selectedIndustries;
            
            dropdown.querySelectorAll('.multi-select-option').forEach(option => {
                const value = option.getAttribute('data-value');
                option.classList.toggle('selected', selected.includes(value));
                
                option.onclick = () => {
                    if (selected.includes(value)) {
                        const index = selected.indexOf(value);
                        selected.splice(index, 1);
                    } else {
                        selected.push(value);
                    }
                    updateMultiSelectDisplay(type, selected);
                    updateDropdownSelection(type);
                };
            });
        }

        function updateMultiSelectDisplay(type, selected) {
            const input = document.getElementById(type + '-input');
            input.value = selected.join(', ');
        }

        // Skills input functionality
        document.getElementById('skills-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const skill = this.value.trim();
                if (skill && !skillsList.includes(skill)) {
                    skillsList.push(skill);
                    updateSkillsDisplay();
                    this.value = '';
                }
            }
        });

        function updateSkillsDisplay() {
            const container = document.getElementById('skills-tags');
            container.innerHTML = skillsList.map(skill => `
                <div class="skill-tag">
                    ${skill}
                    <span class="skill-remove" onclick="removeSkill('${skill}')">×</span>
                </div>
            `).join('');
        }

        function removeSkill(skill) {
            const index = skillsList.indexOf(skill);
            if (index > -1) {
                skillsList.splice(index, 1);
                updateSkillsDisplay();
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.multi-select-container')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(dd => dd.style.display = 'none');
            }
        });

        function generateDetailedAnalysis() {
            // Collect form data
            const userProfile = {
                experience_level: document.getElementById('experience-level').value,
                current_location: document.getElementById('current-location').value,
                job_categories: selectedJobCategories,
                target_roles: document.getElementById('target-roles').value.split(',').map(r => r.trim()).filter(r => r),
                key_skills: skillsList,
                industries: selectedIndustries,
                work_arrangement_preference: document.getElementById('work-style').value,
                estimated_salary_range: document.getElementById('salary-range').value,
                education_level: document.getElementById('education-level').value,
                career_focus: document.getElementById('career-focus').value
            };

            // Hide profile review section and show progress
            document.getElementById('profile-review-section').style.display = 'none';
            showProgress();
            
            // Start detailed analysis
            startDetailedAnalysis(userProfile);
        }

        async function startDetailedAnalysis(userProfile) {
            try {
                await simulateDetailedAnalysis();
                const analysisResults = await generateComprehensiveAnalysis(userProfile);
                showResults(analysisResults, userProfile);
            } catch (error) {
                showMessage('Analysis failed. Please try again.', 'error');
            } finally {
                hideProgress();
            }
        }

        async function simulateDetailedAnalysis() {
            const steps = [
                'Analyzing market competitiveness...',
                'Evaluating target role fit...',
                'Assessing technical skills...',
                'Reviewing experience alignment...',
                'Optimizing resume recommendations...',
                'Calculating salary insights...',
                'Creating career roadmap...',
                'Analyzing job search strategy...',
                'Identifying potential risks...',
                'Generating action plan...'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                updateProgress((i + 1) / steps.length * 100, steps[i]);
                await new Promise(resolve => setTimeout(resolve, 1200));
            }
        }

        async function generateComprehensiveAnalysis(userProfile) {
            const marketScore = calculateRealisticMarketScore(userProfile);
            
            return {
                marketScore,
                analysisResults: generateDetailedAnalysisSections(userProfile, marketScore)
            };
        }

        function calculateRealisticMarketScore(profile) {
            let score = 0;
            let maxScore = 10;

            // Experience Level Assessment (25% of score - 2.5 points max)
            const experienceScore = calculateExperienceScore(profile.experience_level, profile.target_roles);
            score += experienceScore * 0.25;

            // Skills Relevance (30% of score - 3 points max)
            const skillsScore = calculateSkillsScore(profile.key_skills, profile.job_categories);
            score += skillsScore * 0.3;

            // Education Alignment (15% of score - 1.5 points max)
            const educationScore = calculateEducationScore(profile.education_level, profile.experience_level);
            score += educationScore * 0.15;

            // Market Demand (20% of score - 2 points max)
            const marketDemandScore = calculateMarketDemandScore(profile.job_categories, profile.current_location);
            score += marketDemandScore * 0.2;

            // Salary Realism (10% of score - 1 point max)
            const salaryScore = calculateSalaryRealism(profile.estimated_salary_range, profile.experience_level);
            score += salaryScore * 0.1;

            // Round to one decimal place and ensure it's between 1-10
            return Math.max(1, Math.min(10, Math.round(score * 10) / 10));
        }

        function calculateExperienceScore(level, targetRoles) {
            // Base scores by experience level
            const baseScores = {
                'entry': 6,      // Entry level faces more competition
                'mid': 8,        // Sweet spot for most roles
                'senior': 7,     // Good but fewer positions available
                'executive': 6   // Highly competitive, fewer positions
            };

            let score = baseScores[level] || 6;

            // Bonus for having multiple target roles (shows flexibility)
            if (targetRoles && targetRoles.length >= 3) {
                score += 0.5;
            }

            // Penalty for too many target roles (shows lack of focus)
            if (targetRoles && targetRoles.length > 6) {
                score -= 0.5;
            }

            return Math.max(1, Math.min(10, score));
        }

        function calculateSkillsScore(skills, jobCategories) {
            if (!skills || skills.length === 0) return 3;

            let score = 5; // Base score

            // High-demand technical skills
            const highDemandSkills = [
                'Python', 'JavaScript', 'React', 'AWS', 'Docker', 'Kubernetes',
                'Machine Learning', 'Data Analysis', 'SQL', 'Node.js', 'Git',
                'Project Management', 'Agile', 'Scrum', 'Leadership'
            ];

            // Emerging/hot skills
            const emergingSkills = [
                'AI', 'TensorFlow', 'PyTorch', 'Blockchain', 'GraphQL',
                'Microservices', 'DevOps', 'Cloud Architecture'
            ];

            // Calculate skill relevance
            const highDemandCount = skills.filter(skill => 
                highDemandSkills.some(hd => hd.toLowerCase().includes(skill.toLowerCase()) || 
                                           skill.toLowerCase().includes(hd.toLowerCase()))
            ).length;

            const emergingCount = skills.filter(skill =>
                emergingSkills.some(es => es.toLowerCase().includes(skill.toLowerCase()) ||
                                         skill.toLowerCase().includes(es.toLowerCase()))
            ).length;

            // Bonus for relevant skills
            score += (highDemandCount * 0.3);
            score += (emergingCount * 0.5);

            // Bonus for having a good number of skills
            if (skills.length >= 5 && skills.length <= 10) {
                score += 1;
            } else if (skills.length < 3) {
                score -= 1;
            } else if (skills.length > 15) {
                score -= 0.5; // Too many might seem unfocused
            }

            // Job category specific bonuses
            if (jobCategories) {
                if (jobCategories.includes('Software Development') && 
                    skills.some(s => ['Python', 'JavaScript', 'Java', 'React', 'Angular'].includes(s))) {
                    score += 0.5;
                }
                if (jobCategories.includes('Data & Analytics') && 
                    skills.some(s => ['Python', 'SQL', 'Machine Learning', 'Statistics'].includes(s))) {
                    score += 0.5;
                }
                if (jobCategories.includes('Cloud & Infrastructure') && 
                    skills.some(s => ['AWS', 'Azure', 'Docker', 'Kubernetes'].includes(s))) {
                    score += 0.5;
                }
            }

            return Math.max(1, Math.min(10, score));
        }

        function calculateEducationScore(education, experience) {
            const educationScores = {
                'High School': 5,
                'Associate\'s': 6,
                'Bachelor\'s': 7,
                'Master\'s': 8,
                'PhD': 8.5,
                'Professional': 7.5
            };

            let score = educationScores[education] || 6;

            // Education-experience alignment
            if (education === 'PhD' && experience === 'entry') {
                score -= 1; // Might be overqualified for entry level
            }
            if (education === 'High School' && ['senior', 'executive'].includes(experience)) {
                score += 1; // Impressive career progression
            }
            if (education === 'Master\'s' && ['mid', 'senior'].includes(experience)) {
                score += 0.5; // Good alignment
            }

            return Math.max(1, Math.min(10, score));
        }

        function calculateMarketDemandScore(jobCategories, location) {
            if (!jobCategories || jobCategories.length === 0) return 5;

            // Market demand by job category (based on general market trends)
            const demandScores = {
                'Software Development': 9,
                'Data & Analytics': 8.5,
                'Cybersecurity': 9.5,
                'Cloud & Infrastructure': 9,
                'Product & Design': 7,
                'Management & Leadership': 6.5,
                'Sales & Marketing': 6,
                'Finance & Business': 6.5,
                'Healthcare & Life Sciences': 8,
                'Education & Training': 5
            };

            // Calculate average demand score for selected categories
            const avgDemand = jobCategories.reduce((sum, cat) => {
                return sum + (demandScores[cat] || 5);
            }, 0) / jobCategories.length;

            let score = avgDemand;

            // Location bonuses (simplified)
            if (location && location.toLowerCase().includes('san francisco')) {
                score += 1; // Tech hub
            } else if (location && (location.toLowerCase().includes('new york') || 
                                  location.toLowerCase().includes('seattle') ||
                                  location.toLowerCase().includes('austin'))) {
                score += 0.5; // Major tech cities
            } else if (location && location.toLowerCase().includes('remote')) {
                score += 0.3; // Remote work is in demand
            }

            return Math.max(1, Math.min(10, score));
        }

        function calculateSalaryRealism(salaryRange, experienceLevel) {
            if (!salaryRange || !salaryRange.includes('-')) return 5;

            try {
                // Extract numbers from salary range
                const numbers = salaryRange.match(/\d+,?\d*/g);
                if (!numbers || numbers.length < 2) return 5;

                const minSalary = parseInt(numbers[0].replace(',', ''));
                const maxSalary = parseInt(numbers[1].replace(',', ''));

                // Realistic salary ranges by experience level
                const realisticRanges = {
                    'entry': { min: 40000, max: 80000 },
                    'mid': { min: 70000, max: 130000 },
                    'senior': { min: 120000, max: 200000 },
                    'executive': { min: 180000, max: 400000 }
                };

                const realistic = realisticRanges[experienceLevel] || realisticRanges['mid'];

                let score = 7; // Base realistic score

                // Check if salary expectations are realistic
                if (minSalary >= realistic.min * 0.8 && maxSalary <= realistic.max * 1.2) {
                    score = 9; // Very realistic
                } else if (minSalary > realistic.max * 1.3) {
                    score = 3; // Too high expectations
                } else if (maxSalary < realistic.min * 0.7) {
                    score = 4; // Undervaluing themselves
                } else if (minSalary < realistic.min || maxSalary > realistic.max) {
                    score = 6; // Somewhat off but not terrible
                }

                // Check range spread (should be reasonable)
                const spread = maxSalary - minSalary;
                const avgSalary = (maxSalary + minSalary) / 2;
                if (spread / avgSalary > 0.5) {
                    score -= 1; // Range too wide
                } else if (spread / avgSalary < 0.15) {
                    score -= 0.5; // Range too narrow
                }

                return Math.max(1, Math.min(10, score));
            } catch (error) {
                return 5; // Default if parsing fails
            }
        }

        function generateDetailedAnalysisSections(profile, marketScore) {
            return [
                {
                    title: "Market Competitiveness Assessment",
                    icon: "📊",
                    score: marketScore,
                    content: {
                        "Overall Readiness": `${marketScore}/10 for ${profile.target_roles.slice(0, 2).join(' and ')} roles`,
                        "Competitive Analysis": `Strong positioning in ${profile.job_categories.join(' and ')} markets`,
                        "Salary Alignment": `Target range ${profile.estimated_salary_range} aligns with current market standards`,
                        "Geographic Advantage": `${profile.current_location} market shows high demand for your skill set`
                    }
                },
                {
                    title: "Target Role Fit Analysis",
                    icon: "🎯", 
                    score: Math.floor(Math.random() * 2) + 8,
                    content: generateRoleFitAnalysis(profile.target_roles)
                },
                {
                    title: "Technical & Professional Skills Evaluation",
                    icon: "🔧",
                    score: Math.floor(Math.random() * 2) + 7,
                    content: {
                        "Current Strengths": profile.key_skills.join(', '),
                        "Market Demand": "High demand for your core competencies in target market",
                        "Development Areas": "Consider adding: Cloud Architecture, Advanced Analytics, Leadership Skills",
                        "Certifications": "AWS Solutions Architect or relevant industry certifications would add significant value"
                    }
                },
                {
                    title: "Experience & Achievement Analysis", 
                    icon: "📈",
                    score: Math.floor(Math.random() * 2) + 7,
                    content: {
                        "Career Trajectory": `${profile.experience_level} level showing appropriate progression`,
                        "Achievement Quantification": "Strong evidence of business impact and measurable results",
                        "Leadership Evidence": profile.experience_level === 'senior' ? "Clear leadership and mentoring capabilities" : "Growing leadership potential",
                        "Industry Experience": `Solid background in ${profile.industries.join(' and ')} sectors`
                    }
                },
                {
                    title: "Resume Optimization Recommendations",
                    icon: "📝",
                    score: Math.floor(Math.random() * 2) + 6,
                    content: {
                        "ATS Compatibility": "Good keyword optimization for your target roles",
                        "Content Structure": "Professional format with clear progression narrative",
                        "Enhancement Opportunities": "Add more quantified achievements and industry-specific metrics",
                        "Formatting": "Consistent styling with strong visual hierarchy"
                    }
                }
            ];
        }

        function generateRoleFitAnalysis(targetRoles) {
            return targetRoles.reduce((acc, role, index) => {
                const fitScore = 85 + Math.floor(Math.random() * 10);
                const reasons = [
                    'Strong technical alignment with role requirements',
                    'Experience level matches position expectations', 
                    'Skills portfolio directly applicable',
                    'Industry background highly relevant'
                ];
                acc[role] = `${fitScore}% fit - ${reasons[index % reasons.length]}`;
                return acc;
            }, {});
        }

        function showProgress() {
            document.getElementById('progress-section').style.display = 'block';
        }

        function hideProgress() {
            document.getElementById('progress-section').style.display = 'none';
        }

        function updateProgress(percentage, message) {
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = message;
        }

        function showResults(analysis, userProfile) {
            // Show final profile summary
            displayFinalProfile(userProfile);
            
            // Show market readiness score
            document.getElementById('market-score').textContent = `Market Readiness: ${analysis.marketScore}/10`;
            document.getElementById('score-description').textContent = 
                `Overall competitiveness for ${userProfile.target_roles.slice(0,2).join(' and ')} roles`;
            
            // Generate analysis sections
            displayAnalysisSections(analysis.analysisResults);
            
            // Show results section
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
        }

        function displayFinalProfile(profile) {
            const profileGrid = document.getElementById('profile-grid');
            profileGrid.innerHTML = `
                <div class="profile-item">
                    <strong>Experience Level</strong>
                    <div class="profile-value">${profile.experience_level.charAt(0).toUpperCase() + profile.experience_level.slice(1)}</div>
                </div>
                <div class="profile-item">
                    <strong>Target Job Categories</strong>
                    <div class="profile-value">${profile.job_categories.join(' • ')}</div>
                </div>
                <div class="profile-item">
                    <strong>Recommended Roles</strong>
                    <div class="profile-value">${profile.target_roles.slice(0,3).join(' • ')}</div>
                </div>
                <div class="profile-item">
                    <strong>Key Skills</strong>
                    <div class="profile-value">${profile.key_skills.join(' • ')}</div>
                </div>
                <div class="profile-item">
                    <strong>Location & Work Style</strong>
                    <div class="profile-value">${profile.current_location} • ${profile.work_arrangement_preference}</div>
                </div>
                <div class="profile-item">
                    <strong>Estimated Salary Range</strong>
                    <div class="profile-value">${profile.estimated_salary_range}</div>
                </div>
                <div class="profile-item">
                    <strong>Education & Industry</strong>
                    <div class="profile-value">${profile.education_level} • ${profile.industries.join(' • ')}</div>
                </div>
                <div class="profile-item">
                    <strong>Career Focus</strong>
                    <div class="profile-value">${profile.career_focus}</div>
                </div>
            `;
        }

        function displayAnalysisSections(analysisResults) {
            const sectionsContainer = document.getElementById('analysis-sections');
            sectionsContainer.innerHTML = analysisResults.map((section, index) => {
                return `
                    <div class="analysis-section section-${index + 1}">
                        <div class="section-header">
                            <div class="section-icon">${section.icon}</div>
                            <div class="section-title">${section.title}</div>
                            <div class="section-score">${section.score}/10</div>
                        </div>
                        <div class="section-content">
                            ${formatSectionContent(section.content, section.title)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatSectionContent(content, title) {
            if (title === "Target Role Fit Analysis") {
                return `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        ${Object.entries(content).map(([role, fit]) => `
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">${role}</div>
                                <div style="color: #4CAF50; font-weight: 600;">${fit}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                return `
                    ${Object.entries(content).map(([key, value]) => `
                        <div class="subsection">
                            <div class="subsection-title">${key}</div>
                            <p>${value}</p>
                        </div>
                    `).join('')}
                `;
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById(type + '-message');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, type === 'success' ? 3000 : 5000);
        }
    </script>
</body>
</html>
