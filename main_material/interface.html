<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Compass - AI Resume Analysis with Live Job Matches</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
            position: relative;
        }

        .reset-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: none;
        }

        .reset-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-1px);
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .input-options-container {
            margin-bottom: 2rem;
        }

        .upload-area {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 1.5rem;
            text-align: center;
            border: 3px dashed #ddd;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(255,255,255,1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            color: #666;
            margin-bottom: 2rem;
        }

        .file-input {
            display: none;
        }

        .upload-btn, .analyze-text-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover, .analyze-text-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .upload-btn:active, .analyze-text-btn:active {
            transform: translateY(0);
        }

        .divider-container {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            opacity: 0.6;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
        }

        .divider-text {
            margin: 0 2rem;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .text-input-area {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .text-input-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .text-input-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .text-input-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .text-input-subtitle {
            color: #666;
            font-size: 1rem;
        }

        .resume-text-area {
            width: 100%;
            min-height: 300px;
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            line-height: 1.5;
            resize: vertical;
            background: white;
            transition: border-color 0.3s ease;
            margin-bottom: 2rem;
        }

        .resume-text-area:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .analyze-text-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            display: block;
            margin: 0 auto;
            min-width: 250px;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            font-size: 1.2rem;
        }

        .progress-section {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        .results-section {
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 3rem;
        }

        .personalized-tips {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 8px;
        }

        .personalized-tips h3 {
            color: #856404;
            margin-bottom: 1rem;
        }

        .tip-item {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: #856404;
        }

        .tip-item::before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-item {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }

        .filter-select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .job-matches-section {
            margin: 3rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            color: white;
        }

        .job-matches-section h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

       .job-listing {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            padding-bottom: 3rem; 
            margin-bottom: 1rem;
            color: #333;
            transition: all 0.3s ease;
            border-left: 4px solid #4CAF50;
            position: relative;
        }

        .job-listing:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .job-listing.saved {
            border-left-color: #2196F3;
            background: linear-gradient(to right, #e3f2fd 0%, white 10%);
        }
        
        .platform-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1;
        }

       .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding-right: 0;
            position: relative;
        }

        .job-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.3rem;
        }

        .job-company {
            font-size: 1rem;
            color: #666;
        }

        .job-match-score {
            position: absolute;
            bottom: -1rem; 
            right: 0;       
            background: #4CAF50;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            z-index: 1;    
        }

        .job-details {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
        }

        .job-detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.9rem;
        }

        .job-description {
            color: #555;
            line-height: 1.6;
            margin: 1rem 0;
        }

        .job-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .skill-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 16px;
            font-size: 0.85rem;
        }

        .job-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .apply-btn, .save-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            border: none;
        }

        .apply-btn {
            background: #4CAF50;
            color: white;
        }

        .apply-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .save-btn {
            background: white;
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
            display: none;
        }

        .ai-insights-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .weakness-item {
            background: rgba(255,255,255,0.15);
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            border-left: 3px solid #fff;
        }

        .help-tooltip {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 0.3rem;
        }

        .profile-field-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .profile-field-label {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .profile-input, .profile-select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .profile-input:focus, .profile-select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .field-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.3rem;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button type="button" class="reset-btn" id="reset-btn">üîÑ Start Over</button>
            <h1>Career Compass</h1>
            <p>AI-Powered Resume Analysis with Live Job Matches</p>
        </div>

        <div class="input-options-container">
            <div class="upload-area" id="upload-area">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">Upload Your Resume PDF</div>
                <div class="upload-subtext">Drag and drop or click the button below</div>
                <button type="button" class="upload-btn" id="upload-btn">Choose PDF File</button>
                <input type="file" id="file-input" class="file-input" accept=".pdf" />
            </div>

            <div class="divider-container">
                <div class="divider-line"></div>
                <div class="divider-text">OR</div>
                <div class="divider-line"></div>
            </div>

            <div class="text-input-area">
                <div class="text-input-icon">üìù</div>
                <div class="text-input-header">
                    <div class="text-input-title">Paste Your Resume Text</div>
                    <div class="text-input-subtitle">Copy and paste your resume content</div>
                </div>
                <textarea id="resume-text-input" class="resume-text-area" placeholder="Paste your resume here...

John Doe
john.doe@email.com | (555) 123-4567
San Francisco, CA

SOFTWARE ENGINEER
..."></textarea>
                <button type="button" class="analyze-text-btn" id="analyze-btn">Analyze Resume Text</button>
            </div>
        </div>

        <div class="progress-section" id="progress-section">
            <div class="progress-text" id="progress-text">Processing...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <div class="profile-review-section" id="profile-review-section" style="display: none;">
            <div style="background: rgba(255,255,255,0.95); border-radius: 24px; padding: 3rem; margin-bottom: 2rem;">
                <h2 style="text-align: center; color: #2c3e50; margin-bottom: 1rem;">üìã Review Your Extracted Profile</h2>
                <p style="text-align: center; color: #666; margin-bottom: 2rem;">AI has analyzed your resume. Please review and adjust the information below before we search for matching jobs.</p>
                
                <div id="ai-analysis-display" style="display: none;"></div>
                
                <div style="background: #fff9e6; border-left: 4px solid #ffc107; padding: 1.5rem; margin-bottom: 2rem; border-radius: 8px;">
                    <h3 style="color: #f57c00; margin-bottom: 1rem; font-size: 1.2rem;">üí° Why Review This?</h3>
                    <p style="color: #666; line-height: 1.6; margin-bottom: 0.5rem;">The AI has extracted information from your resume, but you can adjust these details to:</p>
                    <ul style="color: #666; margin-left: 1.5rem; line-height: 1.8;">
                        <li>Correct any misinterpreted information</li>
                        <li>Add additional skills or roles you're targeting</li>
                        <li>Refine your location or salary expectations</li>
                        <li>Improve your job search accuracy</li>
                    </ul>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="profile-field-group">
                        <label class="profile-field-label">
                            Your Name
                            <span class="help-tooltip" title="Your full name as it appears on your resume">?</span>
                        </label>
                        <input type="text" id="profile-name" class="profile-input" placeholder="John Doe">
                    </div>
                    
                    <div class="profile-field-group">
                        <label class="profile-field-label">
                            Location
                            <span class="help-tooltip" title="City and state where you want to work">?</span>
                        </label>
                        <input type="text" id="profile-location" class="profile-input" placeholder="San Francisco, CA">
                        <div class="field-hint">Include "Remote" if you're open to remote work</div>
                    </div>
                    
                    <div class="profile-field-group">
                        <label class="profile-field-label">
                            Experience Level
                            <span class="help-tooltip" title="Select the level that best matches your experience">?</span>
                        </label>
                        <select id="profile-experience" class="profile-select">
                            <option value="entry">Entry Level (0-2 years)</option>
                            <option value="mid">Mid Level (3-7 years)</option>
                            <option value="senior">Senior Level (8+ years)</option>
                        </select>
                    </div>
                    
                    <div class="profile-field-group">
                        <label class="profile-field-label">
                            Target Salary Range
                            <span class="help-tooltip" title="Your expected salary range">?</span>
                        </label>
                        <input type="text" id="profile-salary" class="profile-input" placeholder="$70,000 - $90,000">
                        <div class="field-hint">Be realistic based on your experience and location</div>
                    </div>
                    
                    <div class="profile-field-group" style="grid-column: 1 / -1;">
                        <label class="profile-field-label">
                            Career Field
                            <span class="help-tooltip" title="Your primary industry or career field">?</span>
                        </label>
                        <select id="profile-career-field" class="profile-select">
                            <option value="">Select Career Field</option>
                            <option value="Accountant">Accountant</option>
                            <option value="Advocate">Advocate</option>
                            <option value="IT">Information Technology</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Finance">Finance</option>
                            <option value="Sales">Sales</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Education">Education</option>
                            <option value="HR">Human Resources</option>
                        </select>
                    </div>
                    
                    <div class="profile-field-group" style="grid-column: 1 / -1;">
                        <label class="profile-field-label">
                            Target Roles
                            <span class="help-tooltip" title="Job titles you're interested in, separated by commas">?</span>
                        </label>
                        <input type="text" id="profile-roles" class="profile-input" placeholder="Software Engineer, Full Stack Developer, Backend Engineer">
                        <div class="field-hint">List 2-4 job titles you're targeting (e.g., "Data Analyst, Business Analyst")</div>
                    </div>
                    
                    <div class="profile-field-group" style="grid-column: 1 / -1;">
                        <label class="profile-field-label">
                            Skills
                            <span class="help-tooltip" title="Your key technical and professional skills">?</span>
                        </label>
                        <input type="text" id="profile-skills" class="profile-input" placeholder="Python, JavaScript, React, SQL, Project Management">
                        <div class="field-hint">Add or remove skills to match your target roles (comma-separated)</div>
                    </div>
                </div>
                
                <button type="button" id="confirm-profile-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 1.2rem 3rem; border-radius: 50px; font-size: 1.2rem; font-weight: 600; cursor: pointer; display: block; margin: 2rem auto 0; min-width: 250px; transition: all 0.3s ease;">
                    üîç Find Matching Jobs
                </button>
                <p style="text-align: center; color: #999; margin-top: 1rem; font-size: 0.9rem;">We'll search across multiple job platforms for you</p>
            </div>
        </div>

        <div class="results-section" id="results-section"></div>

        <div id="error-message" class="error-message"></div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let userProfile = {};
        let allJobs = [];
        let savedJobs = new Set();

        document.getElementById('upload-btn').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('file-input').click();
        });

        document.getElementById('analyze-btn').addEventListener('click', analyzeResumeText);
        document.getElementById('file-input').addEventListener('change', handleFileUpload);
        document.getElementById('confirm-profile-btn').addEventListener('click', confirmProfileAndFindJobs);
        document.getElementById('reset-btn').addEventListener('click', resetApplication);
        
        const confirmBtn = document.getElementById('confirm-profile-btn');
        confirmBtn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 8px 20px rgba(102, 126, 234, 0.4)';
        });
        confirmBtn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });

        const uploadArea = document.getElementById('upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                document.getElementById('file-input').files = files;
                handleFileUpload({ target: { files: files } });
            }
        });

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                showError('Please upload a PDF file');
                return;
            }

            document.querySelector('.input-options-container').style.display = 'none';
            showProgress();
            
            try {
                updateProgress(20, 'Reading PDF...');
                const resumeText = await extractTextFromPDF(file);
                
                if (resumeText.length < 50) {
                    throw new Error('Could not extract text from PDF');
                }
                
                updateProgress(50, 'Analyzing resume...');
                userProfile = analyzeResumeAdvanced(resumeText);
                
                showProfileReview();
            } catch (error) {
                console.error('Error:', error);
                showError('Analysis failed: ' + error.message);
                document.querySelector('.input-options-container').style.display = 'block';
            } finally {
                hideProgress();
            }
        }

        async function analyzeResumeText() {
            const resumeText = document.getElementById('resume-text-input').value.trim();
            
            if (!resumeText || resumeText.length < 100) {
                showError('Please enter more resume content');
                return;
            }

            document.querySelector('.input-options-container').style.display = 'none';
            showProgress();
            
            try {
                updateProgress(30, 'Analyzing resume...');
                userProfile = analyzeResumeAdvanced(resumeText);
                
                showProfileReview();
            } catch (error) {
                console.error('Error:', error);
                showError('Analysis failed: ' + error.message);
                document.querySelector('.input-options-container').style.display = 'block';
            } finally {
                hideProgress();
            }
        }

        function analyzeResumeAdvanced(resumeText) {
            try {
                const textLower = resumeText.toLowerCase();
                
                const name = extractName(resumeText);
                const location = extractLocation(resumeText);
                const skills = extractSkills(resumeText);
                const experience = determineExperienceLevel(resumeText);
                const roles = extractRoles(resumeText);
                const careerField = detectCareerField(resumeText);
                const salary = estimateSalary(resumeText);
                
                const strengths = [];
                if (skills.length >= 5) strengths.push('Good variety of skills listed');
                if (/\d+%|\d+ years?|managed \d+|increased|improved/i.test(resumeText)) {
                    strengths.push('Includes quantifiable achievements');
                }
                if (textLower.includes('led') || textLower.includes('managed')) {
                    strengths.push('Demonstrates leadership experience');
                }
                if (resumeText.length > 500) {
                    strengths.push('Comprehensive resume content');
                }
                
                const weaknesses = [];
                
                if (!/\d+%/.test(resumeText)) {
                    weaknesses.push({
                        issue: 'No quantifiable achievements with percentages',
                        impact: 'Employers cannot measure your actual impact',
                        fix: 'Add metrics: "Increased sales by 25%" or "Reduced costs by $50K annually"'
                    });
                }
                
                if (skills.length < 5) {
                    weaknesses.push({
                        issue: 'Limited skills section',
                        impact: 'May not pass ATS keyword filters',
                        fix: 'List 8-12 relevant technical and soft skills specific to your target role'
                    });
                }
                
                if (!/led|managed|coordinated|directed|oversaw/i.test(resumeText)) {
                    weaknesses.push({
                        issue: 'Weak action verbs',
                        impact: 'Resume appears passive and less impressive',
                        fix: 'Start bullet points with strong verbs: Led, Managed, Developed, Achieved, Drove'
                    });
                }
                
                if (!textLower.includes('project') && !textLower.includes('initiative')) {
                    weaknesses.push({
                        issue: 'No project or initiative mentions',
                        impact: 'Difficult to assess your practical experience',
                        fix: 'Describe 2-3 key projects with outcomes and technologies used'
                    });
                }
                
                if (resumeText.length < 300) {
                    weaknesses.push({
                        issue: 'Resume is too brief',
                        impact: 'Insufficient information for employers to evaluate you',
                        fix: 'Expand with detailed responsibilities, achievements, and skills for each role'
                    });
                }
                
                let atsScore = 5;
                if (skills.length >= 8) atsScore += 2;
                if (/\d+%/.test(resumeText)) atsScore += 1;
                if (resumeText.length > 400) atsScore += 1;
                if (/led|managed|developed/i.test(resumeText)) atsScore += 1;
                atsScore = Math.min(10, atsScore);
                
                const missingElements = [];
                if (!textLower.includes('@') && !textLower.includes('email')) {
                    missingElements.push('Email address');
                }
                if (!textLower.includes('phone') && !/\(\d{3}\)/.test(resumeText)) {
                    missingElements.push('Phone number');
                }
                if (!textLower.includes('linkedin')) {
                    missingElements.push('LinkedIn profile URL');
                }
                if (!textLower.includes('education') && !textLower.includes('university')) {
                    missingElements.push('Education section');
                }
                
                const improvementPriority = [];
                if (weaknesses.length > 0) {
                    improvementPriority.push('Add quantifiable metrics to all achievements');
                }
                if (skills.length < 8) {
                    improvementPriority.push('Expand skills section with role-specific keywords');
                }
                if (missingElements.length > 0) {
                    improvementPriority.push('Add missing contact information and LinkedIn profile');
                }
                improvementPriority.push('Use stronger action verbs at the start of each bullet point');
                improvementPriority.push('Tailor resume for each job application with relevant keywords');
                
                return {
                    name,
                    location,
                    skills,
                    experience,
                    roles,
                    careerField,
                    salary,
                    strengths,
                    weaknesses,
                    missingElements,
                    atsScore,
                    improvementPriority
                };
            } catch (error) {
                console.error('Analysis error:', error);
                return {
                    name: extractName(resumeText) || 'Candidate',
                    location: 'Not Specified',
                    skills: [],
                    experience: 'entry',
                    roles: ['Professional'],
                    careerField: '',
                    salary: '$45,000 - $70,000',
                    strengths: [],
                    weaknesses: [],
                    missingElements: [],
                    atsScore: 5,
                    improvementPriority: []
                };
            }
        }

        function showProfileReview() {
            document.getElementById('profile-name').value = userProfile.name;
            document.getElementById('profile-location').value = userProfile.location;
            document.getElementById('profile-experience').value = userProfile.experience;
            document.getElementById('profile-salary').value = userProfile.salary;
            document.getElementById('profile-career-field').value = userProfile.careerField || '';
            document.getElementById('profile-roles').value = userProfile.roles.join(', ');
            document.getElementById('profile-skills').value = userProfile.skills.join(', ');
            
            if (userProfile.weaknesses && userProfile.weaknesses.length > 0) {
                displayAIAnalysis();
            }
            
            showResetButton();
            document.getElementById('profile-review-section').style.display = 'block';
            document.getElementById('profile-review-section').scrollIntoView({ behavior: 'smooth' });
        }

        function displayAIAnalysis() {
            const analysisHTML = `
                <div class="ai-insights-box" style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem;">ü§ñ AI Resume Analysis Results</h3>
                    
                    ${userProfile.atsScore ? `
                        <div style="background: rgba(255,255,255,0.2); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; text-align: center;">
                            <div style="font-size: 3rem; font-weight: bold; margin-bottom: 0.5rem;">
                                ${userProfile.atsScore}/10
                            </div>
                            <div style="font-size: 1.2rem; opacity: 0.95; margin-bottom: 0.5rem;">ATS Compatibility Score</div>
                            <div style="opacity: 0.9; font-size: 0.95rem;">
                                ${userProfile.atsScore >= 8 ? '‚úÖ Excellent - Your resume should pass automated screening' :
                                  userProfile.atsScore >= 6 ? '‚ö†Ô∏è Good - Some improvements needed' :
                                  userProfile.atsScore >= 4 ? '‚ö†Ô∏è Fair - Significant improvements needed' :
                                  '‚ùå Poor - High risk of automated rejection'}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${userProfile.strengths && userProfile.strengths.length > 0 ? `
                        <div style="margin-bottom: 1.5rem;">
                            <h4 style="margin-bottom: 0.8rem; font-size: 1.2rem;">‚úÖ What's Working Well</h4>
                            <div style="background: rgba(255,255,255,0.15); padding: 1.2rem; border-radius: 8px;">
                                <ul style="margin-left: 1.5rem; line-height: 2;">
                                    ${userProfile.strengths.map(s => `<li style="margin-bottom: 0.5rem;">${s}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${userProfile.weaknesses && userProfile.weaknesses.length > 0 ? `
                        <div style="margin-bottom: 1.5rem;">
                            <h4 style="margin-bottom: 0.8rem; font-size: 1.2rem;">‚ö†Ô∏è Critical Issues to Address</h4>
                            <p style="opacity: 0.9; margin-bottom: 1rem; font-size: 0.95rem;">These problems could prevent you from getting interviews. Fix them before applying:</p>
                            ${userProfile.weaknesses.map((w, i) => `
                                <div class="weakness-item" style="margin-bottom: 1rem; border-left-color: ${i === 0 ? '#ff6b6b' : i === 1 ? '#ffa500' : '#fff'};">
                                    <div style="font-weight: 700; margin-bottom: 0.5rem; font-size: 1.05rem;">
                                        ${i + 1}. ${w.issue}
                                    </div>
                                    <div style="opacity: 0.95; margin-bottom: 0.5rem;">
                                        <strong>Impact:</strong> ${w.impact}
                                    </div>
                                    <div style="opacity: 0.95; background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 6px;">
                                        <strong>‚úÖ Solution:</strong> ${w.fix}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${userProfile.missingElements && userProfile.missingElements.length > 0 ? `
                        <div style="margin-bottom: 1.5rem;">
                            <h4 style="margin-bottom: 0.8rem; font-size: 1.2rem;">üìã Missing From Your Resume</h4>
                            <div style="background: rgba(255,255,255,0.15); padding: 1.2rem; border-radius: 8px;">
                                <ul style="margin-left: 1.5rem; line-height: 2;">
                                    ${userProfile.missingElements.map(m => `<li style="margin-bottom: 0.5rem;">${m}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${userProfile.improvementPriority && userProfile.improvementPriority.length > 0 ? `
                        <div style="background: rgba(255,255,255,0.2); padding: 1.5rem; border-radius: 12px;">
                            <h4 style="margin-bottom: 1rem; font-size: 1.2rem;">üéØ Your Action Plan (Priority Order)</h4>
                            <p style="opacity: 0.9; margin-bottom: 1rem; font-size: 0.95rem;">Do these in order for maximum impact:</p>
                            <ol style="margin-left: 1.5rem; line-height: 2.2;">
                                ${userProfile.improvementPriority.map((p, i) => `
                                    <li style="margin-bottom: 0.5rem;">
                                        <strong style="font-size: ${i === 0 ? '1.1rem' : '1rem'};">${p}</strong>
                                    </li>
                                `).join('')}
                            </ol>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('ai-analysis-display').innerHTML = analysisHTML;
            document.getElementById('ai-analysis-display').style.display = 'block';
        }

        async function confirmProfileAndFindJobs() {
            userProfile.name = document.getElementById('profile-name').value;
            userProfile.location = document.getElementById('profile-location').value;
            userProfile.experience = document.getElementById('profile-experience').value;
            userProfile.salary = document.getElementById('profile-salary').value;
            userProfile.careerField = document.getElementById('profile-career-field').value;
            userProfile.roles = document.getElementById('profile-roles').value.split(',').map(r => r.trim());
            userProfile.skills = document.getElementById('profile-skills').value.split(',').map(s => s.trim());
            
            document.getElementById('profile-review-section').style.display = 'none';
            showProgress();
            
            try {
                updateProgress(50, 'Finding jobs...');
                await fetchJobMatches();
                
                updateProgress(80, 'Analyzing matches...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                updateProgress(100, 'Complete!');
                displayResults();
            } catch (error) {
                showError('Error: ' + error.message);
            } finally {
                setTimeout(hideProgress, 500);
            }
        }

        async function extractTextFromPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
                const pdf = await loadingTask.promise;
                let fullText = '';

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => {
                        return item.str || '';
                    }).join(' ');
                    fullText += pageText + '\n';
                }

                const cleanedText = fullText.trim();
                
                if (cleanedText.length < 50) {
                    throw new Error('PDF appears to be empty or text could not be extracted. Please try pasting your resume text instead.');
                }

                return cleanedText;
            } catch (error) {
                console.error('PDF extraction error:', error);
                throw new Error('PDF reading failed: ' + error.message);
            }
        }

        function extractName(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            
            for (let i = 0; i < Math.min(8, lines.length); i++) {
                const line = lines[i];
                
                if (line.includes('@') || line.match(/\d{3}[-.)]\d{3}/) || line.includes('http') || line.includes('linkedin')) continue;
                
                if (/^(resume|cv|curriculum vitae|profile|summary|experience|education|skills)$/i.test(line)) continue;
                
                const words = line.split(/\s+/);
                
                if (words.length >= 2 && words.length <= 4) {
                    const isLikelyName = words.every(w => 
                        /^[A-Z][a-z]{1,}/.test(w) || /^[A-Z]\.?$/.test(w)
                    );
                    
                    if (isLikelyName && line.length <= 50) {
                        return line;
                    }
                }
            }
            return 'Candidate';
        }

        function extractLocation(text) {
            const cityStateMatch = text.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z]{2})\b/);
            if (cityStateMatch) return cityStateMatch[0];
            
            const cityStateFullMatch = text.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/);
            if (cityStateFullMatch) return cityStateFullMatch[0];
            
            if (/\b(remote|work from home|wfh|anywhere)\b/i.test(text)) return 'Remote';
            
            const lines = text.split('\n').slice(0, 10);
            for (const line of lines) {
                if (line.includes('@')) continue;
                const cityMatch = line.match(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+){0,2}),\s*[A-Z]{2}\b/);
                if (cityMatch) return cityMatch[0];
            }
            
            return 'Not Specified';
        }

        function extractSkills(text) {
            const commonSkills = [
                'Python', 'JavaScript', 'Java', 'C\\+\\+', 'C#', 'Ruby', 'PHP', 'Swift', 'Kotlin',
                'React', 'Angular', 'Vue', 'Node\\.js', 'Express', 'Django', 'Flask',
                'SQL', 'MySQL', 'PostgreSQL', 'MongoDB', 'Redis',
                'AWS', 'Azure', 'Google Cloud', 'Docker', 'Kubernetes',
                'Git', 'GitHub', 'GitLab', 'CI/CD', 'Jenkins',
                'Excel', 'PowerPoint', 'Word', 'Tableau', 'Power BI',
                'Leadership', 'Communication', 'Project Management', 'Agile', 'Scrum',
                'Problem Solving', 'Team Collaboration', 'Critical Thinking',
                'HTML', 'CSS', 'TypeScript', 'REST API', 'GraphQL',
                'Machine Learning', 'Data Analysis', 'Statistics'
            ];
            
            const foundSkills = [];
            commonSkills.forEach(skill => {
                const regex = new RegExp('\\b' + skill + '\\b', 'i');
                if (regex.test(text)) {
                    const cleanSkill = skill.replace(/\\\\/g, '').replace(/\\\./g, '.').replace(/\\\+/g, '+');
                    foundSkills.push(cleanSkill);
                }
            });
            
            return foundSkills;
        }

        function determineExperienceLevel(text) {
            const textLower = text.toLowerCase();
            
            const yearPatterns = [
                /(\d+)\+?\s*years?\s*(?:of\s*)?(?:experience|exp)/i,
                /experience:\s*(\d+)\+?\s*years?/i,
                /(\d+)\+?\s*yrs?\s*(?:experience|exp)/i
            ];
            
            for (const pattern of yearPatterns) {
                const match = text.match(pattern);
                if (match) {
                    const years = parseInt(match[1]);
                    if (years >= 0 && years <= 2) return 'entry';
                    if (years >= 3 && years <= 7) return 'mid';
                    if (years >= 8) return 'senior';
                }
            }
            
            if (/\b(senior|lead|principal|director|manager|head of|vp|vice president|chief)\b/i.test(textLower)) {
                return 'senior';
            }
            
            if (/\b(junior|entry|associate|intern|graduate|trainee|assistant)\b/i.test(textLower)) {
                return 'entry';
            }
            
            const dateMatches = text.match(/\b(20\d{2}|19\d{2})\b/g) || [];
            const jobCount = Math.floor(dateMatches.length / 2);
            
            if (jobCount >= 3) return 'senior';
            if (jobCount >= 1) return 'mid';
            
            return 'entry';
        }

        function extractRoles(text) {
            const roles = [
                'Software Engineer', 'Software Developer', 'Full Stack Developer', 'Frontend Developer', 'Backend Developer',
                'Web Developer', 'Mobile Developer', 'iOS Developer', 'Android Developer',
                'DevOps Engineer', 'Cloud Engineer', 'Systems Administrator', 'Network Engineer',
                'Data Engineer', 'Data Analyst', 'Data Scientist', 'Machine Learning Engineer', 'AI Engineer',
                'QA Engineer', 'Test Engineer', 'Quality Assurance',
                'UX Designer', 'UI Designer', 'Graphic Designer', 'Product Designer', 'Web Designer',
                'Business Analyst', 'Product Manager', 'Project Manager', 'Program Manager',
                'Management Consultant', 'Strategy Consultant',
                'Marketing Manager', 'Digital Marketing Specialist', 'Content Marketing Manager',
                'Sales Representative', 'Account Manager', 'Business Development',
                'Sales Manager', 'Account Executive',
                'Financial Analyst', 'Accountant', 'Controller', 'Finance Manager',
                'Investment Analyst', 'Credit Analyst',
                'HR Manager', 'Recruiter', 'Talent Acquisition', 'HR Specialist',
                'Nurse', 'Registered Nurse', 'Physician', 'Medical Assistant',
                'Healthcare Administrator',
                'Teacher', 'Professor', 'Instructor', 'Academic Advisor',
                'Customer Success Manager', 'Operations Manager', 'Supply Chain Manager',
                'Legal Counsel', 'Paralegal', 'Executive Assistant', 'Administrative Assistant'
            ];
            
            const found = [];
            const foundTitles = new Set();

            for (const role of roles) {
                // Fix the escape string pattern and remove the erroneous if condition
                const escapedRole = role.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp('\\b' + escapedRole + '\\b', 'gi');
                if (regex.test(text) && !foundTitles.has(role.toLowerCase())) {
                    found.push(role);
                    foundTitles.add(role.toLowerCase());
                }
            }

            if (found.length === 0) {
                const lines = text.split('\n').map(l => l.trim()).filter(l => l);
                for (let i = 0; i < Math.min(15, lines.length); i++) {
                    const line = lines[i];
                    if (line.includes('@') || line.match(/\d{3}[-.)]\d{3}/)) continue;
                    
                    if (/\b(engineer|developer|analyst|manager|designer|specialist|coordinator|administrator|consultant)\b/i.test(line)) {
                        if (line.length < 100) {
                            found.push(line);
                            break;
                        }
                    }
                }
            }

            return found.length > 0 ? found.slice(0, 3) : ['Professional'];
            }

            function detectCareerField(text) {
            const textLower = text.toLowerCase();

            const keywords = {
                'IT': ['software', 'developer', 'programmer', 'engineer', 'coding', 'programming', 'javascript', 'python', 'java', 'web development', 'mobile app', 'full stack', 'backend', 'frontend', 'devops', 'cloud', 'database', 'sql'],
                'Healthcare': ['nurse', 'doctor', 'medical', 'healthcare', 'clinical', 'patient', 'hospital', 'physician', 'rn', 'registered nurse', 'medical assistant'],
                'Finance': ['finance', 'accounting', 'analyst', 'investment', 'banking', 'financial', 'accountant', 'cpa', 'bookkeeping', 'audit', 'tax'],
                'Sales': ['sales', 'business development', 'account', 'revenue', 'account executive', 'sales representative', 'client relations'],
                'Marketing': ['marketing', 'advertising', 'campaign', 'brand', 'seo', 'content', 'social media', 'digital marketing', 'marketing manager'],
                'Engineering': ['mechanical', 'electrical', 'civil', 'chemical', 'structural', 'manufacturing', 'industrial engineer'],
                'Education': ['teacher', 'professor', 'educator', 'instructor', 'academic', 'teaching', 'curriculum', 'classroom'],
                'HR': ['human resources', 'hr', 'recruitment', 'talent acquisition', 'recruiter', 'talent', 'employee relations'],
                'Accountant': ['accountant', 'accounting', 'bookkeeper', 'cpa', 'accounts payable', 'accounts receivable', 'general ledger'],
                'Advocate': ['legal', 'lawyer', 'attorney', 'advocate', 'counsel', 'paralegal', 'law']
            };

            const scores = {};

            for (const [field, words] of Object.entries(keywords)) {
                scores[field] = 0;
                words.forEach(keyword => {
                    // Fix the escape string pattern
                    const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp('\\b' + escapedKeyword + '\\b', 'gi');
                    const matches = textLower.match(regex);
                    if (matches) {
                        scores[field] += matches.length;
                    }
                });
            }
            
            let maxScore = 0;
            let topField = '';
            
            for (const [field, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    topField = field;
                }
            }
            
            return maxScore > 0 ? topField : '';
        }

        function estimateSalary(text) {
            const salaryPatterns = [
                /\$\s*(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s*(?:-|to)\s*\$?\s*(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)/i,
                /salary\s*(?:range|expectation)?:?\s*\$?\s*(\d{1,3}(?:,\d{3})*)/i,
                /compensation\s*(?:range)?:?\s*\$?\s*(\d{1,3}(?:,\d{3})*)/i
            ];
            
            for (const pattern of salaryPatterns) {
                const match = text.match(pattern);
                if (match) {
                    return match[0];
                }
            }
            
            const exp = determineExperienceLevel(text);
            const field = detectCareerField(text);
            
            const fieldMultipliers = {
                'IT': 1.2,
                'Finance': 1.15,
                'Engineering': 1.1,
                'Healthcare': 1.0,
                'Sales': 0.95,
                'Marketing': 0.95,
                'HR': 0.9,
                'Education': 0.85,
                'Accountant': 1.0,
                'Advocate': 1.15
            };
            
            const multiplier = fieldMultipliers[field] || 1.0;
            
            const baseRanges = {
                'entry': [45000, 70000],
                'mid': [70000, 105000],
                'senior': [105000, 150000]
            };
            
            const [low, high] = baseRanges[exp] || baseRanges['entry'];
            const adjustedLow = Math.round((low * multiplier) / 1000) * 1000;
            const adjustedHigh = Math.round((high * multiplier) / 1000) * 1000;
            
            return `${adjustedLow.toLocaleString()} - ${adjustedHigh.toLocaleString()}`;
        }

        async function fetchJobMatches() {
            await new Promise(resolve => setTimeout(resolve, 1000));
            allJobs = generateJobs(userProfile);
        }

        function generateJobs(profile) {
            const jobs = [];
            const roles = profile.roles.length > 0 ? profile.roles : ['Professional'];
            
            roles.forEach((role, idx) => {
                const encodedRole = encodeURIComponent(role);
                const encodedLocation = encodeURIComponent(profile.location);
                
                const jobBoards = [
                    { 
                        name: 'Indeed', 
                        url: `https://www.indeed.com/jobs?q=${encodedRole}&l=${encodedLocation}`,
                        description: 'Search millions of jobs on Indeed'
                    },
                    { 
                        name: 'LinkedIn', 
                        url: `https://www.linkedin.com/jobs/search/?keywords=${encodedRole}&location=${encodedLocation}`,
                        description: 'Professional network with verified companies'
                    },
                    { 
                        name: 'Glassdoor', 
                        url: `https://www.glassdoor.com/Job/jobs.htm?sc.keyword=${encodedRole}&locT=C&locId=1147401`,
                        description: 'Jobs with company reviews and salary insights'
                    },
                    { 
                        name: 'ZipRecruiter', 
                        url: `https://www.ziprecruiter.com/jobs-search?search=${encodedRole}&location=${encodedLocation}`,
                        description: 'AI-powered job matching platform'
                    },
                    { 
                        name: 'Monster', 
                        url: `https://www.monster.com/jobs/search?q=${encodedRole}&where=${encodedLocation}`,
                        description: 'Extensive job database with career resources'
                    }
                ];
                
                jobBoards.forEach((board, i) => {
                    const matchScore = 95 - (idx * 3) - (i * 2);
                    jobs.push({
                        id: jobs.length + 1,
                        title: role,
                        platform: board.name,
                        location: profile.location,
                        matchScore: matchScore,
                        description: board.description,
                        url: board.url,
                        skills: profile.skills.slice(0, 6),
                        experience: profile.experience
                    });
                });
            });

            return jobs.sort((a, b) => b.matchScore - a.matchScore);
        }

        function displayResults() {
            const resultsHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 2rem; margin-bottom: 2rem;">
                    <h2 style="text-align: center; margin-bottom: 1.5rem;">Resume Analysis Summary</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                            <strong style="opacity: 0.8; font-size: 0.9rem;">Name</strong>
                            <div style="font-size: 1.1rem; font-weight: 600;">${userProfile.name}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                            <strong style="opacity: 0.8; font-size: 0.9rem;">Location</strong>
                            <div style="font-size: 1.1rem; font-weight: 600;">${userProfile.location}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                            <strong style="opacity: 0.8; font-size: 0.9rem;">Experience</strong>
                            <div style="font-size: 1.1rem; font-weight: 600;">${userProfile.experience.charAt(0).toUpperCase() + userProfile.experience.slice(1)} Level</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                            <strong style="opacity: 0.8; font-size: 0.9rem;">Target Salary</strong>
                            <div style="font-size: 1.1rem; font-weight: 600;">${userProfile.salary}</div>
                        </div>
                    </div>
                </div>

                ${userProfile.weaknesses && userProfile.weaknesses.length > 0 ? `
                    <div class="ai-insights-box" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;">üéØ Before You Apply - Fix These Issues</h3>
                        <p style="opacity: 0.9; margin-bottom: 1.5rem;">These issues could prevent you from getting interviews. Address them to improve your chances:</p>
                        
                        ${userProfile.improvementPriority && userProfile.improvementPriority.length > 0 ? `
                            <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; font-size: 1.1rem;">üìã Action Plan (Do These First):</h4>
                                <ol style="margin-left: 1.5rem; line-height: 2;">
                                    ${userProfile.improvementPriority.slice(0, 3).map((p, i) => `
                                        <li style="margin-bottom: 0.5rem;">
                                            <strong style="color: ${i === 0 ? '#fff' : 'rgba(255,255,255,0.9)'};">${p}</strong>
                                        </li>
                                    `).join('')}
                                </ol>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 1rem;">
                            <h4 style="margin-bottom: 1rem; font-size: 1.1rem;">‚ö†Ô∏è Critical Issues:</h4>
                            ${userProfile.weaknesses.slice(0, 5).map((w, i) => `
                                <div style="background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid ${i === 0 ? '#ff6b6b' : '#ffa500'};">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem; font-size: 1.05rem;">
                                        ${i + 1}. ${w.issue}
                                    </div>
                                    <div style="opacity: 0.95; margin-bottom: 0.5rem; padding-left: 1rem;">
                                        <strong>Why it matters:</strong> ${w.impact}
                                    </div>
                                    <div style="opacity: 0.95; padding-left: 1rem; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;">
                                        <strong>‚úÖ How to fix:</strong> ${w.fix}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${userProfile.missingElements && userProfile.missingElements.length > 0 ? `
                            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 8px;">
                                <h4 style="margin-bottom: 0.8rem;">üìã Missing From Your Resume:</h4>
                                <ul style="margin-left: 1.5rem; line-height: 2;">
                                    ${userProfile.missingElements.map(m => `<li>${m}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}

                <div class="personalized-tips">
                    <h3>üìä Resume Analysis Summary</h3>
                    <div id="tips-content">
                        ${userProfile.atsScore ? `
                            <div class="tip-item" style="font-size: 1.05rem; font-weight: 600; color: ${userProfile.atsScore >= 7 ? '#2e7d32' : userProfile.atsScore >= 5 ? '#f57c00' : '#c62828'};">
                                ATS Compatibility: ${userProfile.atsScore}/10 ${userProfile.atsScore >= 7 ? '‚úÖ Good' : userProfile.atsScore >= 5 ? '‚ö†Ô∏è Needs Work' : '‚ùå Poor - High Rejection Risk'}
                            </div>
                        ` : ''}
                        <div class="tip-item">Extracted ${userProfile.skills.length} skills from your resume</div>
                        <div class="tip-item">${allJobs.filter(j => j.matchScore >= 90).length} job search platforms ready with 90%+ match</div>
                        <div class="tip-item">Experience level: ${userProfile.experience.charAt(0).toUpperCase() + userProfile.experience.slice(1)} (${
                            userProfile.experience === 'entry' ? '0-2 years' : 
                            userProfile.experience === 'mid' ? '3-7 years' : '8+ years'
                        })</div>
                        <div class="tip-item">Targeting ${userProfile.roles.length} different role(s) in ${userProfile.careerField || 'multiple fields'}</div>
                    </div>
                    ${userProfile.atsScore && userProfile.atsScore < 7 ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.3); border-radius: 8px;">
                            <strong style="color: #c62828;">‚ö†Ô∏è Warning:</strong> Your ATS score is low. Many companies use automated systems that may reject your resume before a human sees it. Fix the issues above to improve your chances.
                        </div>
                    ` : ''}
                </div>

                <div class="filter-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Filter Job Searches</h3>
                        <div id="saved-counter" style="background: #2196F3; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600; font-size: 0.9rem; display: none;">
                            üìå <span id="saved-count">0</span> Saved
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-item">
                            <label class="filter-label">Job Platform</label>
                            <select class="filter-select" id="platform-filter">
                                <option value="">All Platforms</option>
                                <option value="Indeed">Indeed</option>
                                <option value="LinkedIn">LinkedIn</option>
                                <option value="Glassdoor">Glassdoor</option>
                                <option value="ZipRecruiter">ZipRecruiter</option>
                                <option value="Monster">Monster</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Target Role</label>
                            <select class="filter-select" id="role-filter">
                                <option value="">All Roles</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Experience Level</label>
                            <select class="filter-select" id="experience-filter">
                                <option value="">All Levels</option>
                                <option value="entry">Entry</option>
                                <option value="mid">Mid</option>
                                <option value="senior">Senior</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="job-matches-section">
                    <h2>üéØ Your Personalized Job Search Links</h2>
                    <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <p style="text-align: center; opacity: 0.95; margin-bottom: 1rem; font-size: 1.05rem;">
                            We've created direct search links to the top job platforms, pre-filled with your information
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                            <div style="text-align: center; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.3rem;">üìç</div>
                                <div style="font-size: 0.9rem;">Location: ${userProfile.location}</div>
                            </div>
                            <div style="text-align: center; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.3rem;">üíº</div>
                                <div style="font-size: 0.9rem;">${userProfile.roles.length} Role Type(s)</div>
                            </div>
                            <div style="text-align: center; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.3rem;">üåê</div>
                                <div style="font-size: 0.9rem;">${[...new Set(allJobs.map(j => j.platform))].length} Platforms</div>
                            </div>
                            <div style="text-align: center; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.3rem;">üéØ</div>
                                <div style="font-size: 0.9rem;">${allJobs.length} Search Links</div>
                            </div>
                        </div>
                        <p style="text-align: center; margin-top: 1rem; font-size: 0.95rem; opacity: 0.9;">
                            üí° Tip: Click multiple platforms to maximize your job search coverage
                        </p>
                    </div>
                    <div id="job-listings-container"></div>
                </div>
            `;

            document.getElementById('results-section').innerHTML = resultsHTML;

            const roles = [...new Set(allJobs.map(j => j.title))];
            const roleFilter = document.getElementById('role-filter');
            roleFilter.innerHTML = '<option value="">All Roles</option>';
            roles.forEach(role => {
                roleFilter.innerHTML += `<option value="${role}">${role}</option>`;
            });

            document.getElementById('platform-filter').addEventListener('change', filterJobs);
            document.getElementById('role-filter').addEventListener('change', filterJobs);
            document.getElementById('experience-filter').addEventListener('change', filterJobs);

            displayJobs(allJobs);
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
        }

        function displayJobs(jobs) {
            const container = document.getElementById('job-listings-container');
            
            if (jobs.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:white;">No jobs found matching your filters</p>';
                return;
            }

            container.innerHTML = jobs.map(job => `
                <div class="job-listing ${savedJobs.has(job.id) ? 'saved' : ''}" id="job-${job.id}">
                    <div class="platform-badge">${job.platform}</div>
                    <div class="job-header">
                        <div>
                            <div class="job-title">${job.title}</div>
                            <div class="job-company" style="margin-top: 0.3rem;">Search on ${job.platform}</div>
                        </div>
                        <div class="job-match-score">${job.matchScore}% Match</div>
                    </div>
                    
                    <div class="job-details" style="margin-top: 1rem;">
                        <div class="job-detail-item">üìç ${job.location}</div>
                        <div class="job-detail-item">üíº ${job.experience.charAt(0).toUpperCase() + job.experience.slice(1)} Level</div>
                        <div class="job-detail-item">üéØ ${job.matchScore >= 90 ? 'Excellent Match' : job.matchScore >= 80 ? 'Good Match' : 'Moderate Match'}</div>
                    </div>

                    <div class="job-description" style="margin-top: 1rem;">${job.description}</div>

                    <div class="job-skills" style="margin-top: 1rem;">
                        <strong style="display: block; margin-bottom: 0.5rem; color: #666; font-size: 0.9rem;">Your matching skills:</strong>
                        ${job.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                    </div>

                    <div class="job-actions" style="margin-top: 1.5rem;">
                        <a href="${job.url}" target="_blank" rel="noopener noreferrer" class="apply-btn" style="text-decoration: none;">
                            üîç Search on ${job.platform} ‚Üí
                        </a>
                        <button class="save-btn" onclick="saveJob(${job.id})" aria-label="${savedJobs.has(job.id) ? 'Unsave job' : 'Save job'}">
                            ${savedJobs.has(job.id) ? '‚úì Saved' : 'üíæ Save'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterJobs() {
            const platform = document.getElementById('platform-filter').value;
            const role = document.getElementById('role-filter').value;
            const exp = document.getElementById('experience-filter').value;

            const filtered = allJobs.filter(job => {
                return (!platform || job.platform === platform) &&
                       (!role || job.title === role) &&
                       (!exp || job.experience === exp);
            });

            displayJobs(filtered);
        }

        function saveJob(jobId) {
            if (savedJobs.has(jobId)) {
                savedJobs.delete(jobId);
            } else {
                savedJobs.add(jobId);
            }
            
            const jobCard = document.getElementById(`job-${jobId}`);
            if (jobCard) {
                if (savedJobs.has(jobId)) {
                    jobCard.classList.add('saved');
                    const saveBtn = jobCard.querySelector('.save-btn');
                    saveBtn.textContent = '‚úì Saved';
                    saveBtn.setAttribute('aria-label', 'Unsave job');
                } else {
                    jobCard.classList.remove('saved');
                    const saveBtn = jobCard.querySelector('.save-btn');
                    saveBtn.textContent = 'üíæ Save';
                    saveBtn.setAttribute('aria-label', 'Save job');
                }
            }
            
            updateSavedCounter();
        }
        
        function updateSavedCounter() {
            const counter = document.getElementById('saved-counter');
            const count = document.getElementById('saved-count');
            if (savedJobs.size > 0) {
                counter.style.display = 'block';
                count.textContent = savedJobs.size;
            } else {
                counter.style.display = 'none';
            }
        }

        function showProgress() {
            document.getElementById('progress-section').style.display = 'block';
        }

        function hideProgress() {
            document.getElementById('progress-section').style.display = 'none';
        }

        function updateProgress(percentage, message) {
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = message;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function resetApplication() {
            userProfile = {};
            allJobs = [];
            savedJobs = new Set();
            
            document.getElementById('file-input').value = '';
            document.getElementById('resume-text-input').value = '';
            document.getElementById('profile-review-section').style.display = 'none';
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('reset-btn').style.display = 'none';
            
            document.querySelector('.input-options-container').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showResetButton() {
            document.getElementById('reset-btn').style.display = 'block';
        }
    </script>
</body>
</html>
